<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This module contains arguments and functions to manage safe and module. SafeModuleSubcommands defines three subcommands: create, move, and migrate."><title>hopli_lib::safe_module - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-80aa586b.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="hopli_lib" data-themes="" data-resource-suffix="" data-rustdoc-version="1.94.0-nightly (e7d44143a 2025-12-24)" data-channel="nightly" data-search-js="search-9e2438ea.js" data-stringdex-js="stringdex-b897f86f.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-3e30299d.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-ffcac47a.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-eab170b8.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-044be391.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module safe_module</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../hopli_lib/index.html">hopli_<wbr>lib</a><span class="version">0.13.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module safe_<wbr>module</a></h2><h3><a href="#enums">Module Items</a></h3><ul class="block"><li><a href="#enums" title="Enums">Enums</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate hopli_<wbr>lib</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">hopli_lib</a></div><h1>Module <span>safe_<wbr>module</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/hopli_lib/safe_module.rs.html#1-783">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This module contains arguments and functions to manage safe and module.
<a href="enum.SafeModuleSubcommands.html" title="enum hopli_lib::safe_module::SafeModuleSubcommands">SafeModuleSubcommands</a> defines three subcommands: create, move, and migrate.</p>
<ul>
<li><a href="enum.SafeModuleSubcommands.html#variant.Create" title="variant hopli_lib::safe_module::SafeModuleSubcommands::Create">SafeModuleSubcommands::Create</a> creates staking wallets (safe and node management module) and execute necessary
on-chain transactions to setup a HOPR node. Detailed breakdown of the steps:
<ul>
<li>create a Safe proxy instance and HOPR node management module proxy instance</li>
<li>include nodes configure default permissions on the created module proxy</li>
<li>fund the node and Safe with some native tokens and HOPR tokens respectively</li>
<li>approve HOPR tokens to be transferred from the Safe proxy instaces by Channels contract</li>
<li>Use manager wallet to add nodes and staking safes to the Network Registry contract</li>
</ul>
</li>
<li><a href="enum.SafeModuleSubcommands.html#variant.Move" title="variant hopli_lib::safe_module::SafeModuleSubcommands::Move">SafeModuleSubcommands::Move</a> moves a node from to an existing Safe. Note that the Safe should has a node
management module attached and configured. Note that the admin key of the old and new safes are the same. This
command does not support moving nodes to safes controled by a different admin key. Note that all the safes
involved (old and new) should have a threshold of 1 Detailed breakdown of the steps:
<ul>
<li>use old safes to deregister nodes from Node-safe registry</li>
<li>use the new safe to include nodes to the module</li>
<li>use manager wallet to deregister nodes from the network registry</li>
<li>use manager wallet to register nodes with new safes to the network regsitry</li>
</ul>
</li>
<li><a href="enum.SafeModuleSubcommands.html#variant.Migrate" title="variant hopli_lib::safe_module::SafeModuleSubcommands::Migrate">SafeModuleSubcommands::Migrate</a> migrates a node to a different network. It performs the following steps:
<ul>
<li>add the Channel contract of the new network to the module as target and set default permissions.</li>
<li>add the Announcement contract as target to the module</li>
<li>approve HOPR tokens of the Safe proxy to be transferred by the new Channels contract</li>
<li>Use the manager wallet to add nodes and Safes to the Network Registry contract of the new network.</li>
</ul>
</li>
<li><a href="enum.SafeModuleSubcommands.html#variant.Debug" title="variant hopli_lib::safe_module::SafeModuleSubcommands::Debug">SafeModuleSubcommands::Debug</a> goes through a series of checks to debug the setup of a node and safe.</li>
</ul>
<p>It checks the following:
- node xDAI balance
- If node has been included on Network Registry
- If node and safe are associated on Node Safe Registry
- If Safe is owned by the correct owner(s)
- Safe’s wxHOPR balance and allowance
- if the module is enabled
- if node is included in the module
- Get all the targets of the safe (then check if channel and announcement are there)
- Get the owner of the module</p>
<p>You need to enable the INFO level of the tracing logger to see the output of the debug command.</p>
<p>Some sample commands</p>
<ul>
<li>Express creation of a safe and a module</li>
</ul>
<div class="example-wrap"><pre class="language-text"><code>hopli safe-module create \
    --network anvil-localhost \
    --contracts-root &quot;../ethereum/contracts&quot; \
    --identity-directory &quot;./test&quot; \
    --password-path &quot;./test/pwd&quot; \
    --admin-address 0x47f2710069F01672D01095cA252018eBf08bF85e,0x0D07Eb66Deb54D48D004765E13DcC028cf56592b \
    --allowance 10.5 \
    --hopr-amount 10 \
    --native-amount 0.1 \
    --manager-private-key ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
    --private-key 59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d \
    --provider-url &quot;http://localhost:8545&quot;</code></pre></div>
<ul>
<li>Migrate nodes and safe to a new network</li>
</ul>
<div class="example-wrap"><pre class="language-text"><code>hopli safe-module migrate \
    --network anvil-localhost2 \
    --contracts-root &quot;../ethereum/contracts&quot; \
    --identity-directory &quot;./test&quot; \
    --password-path &quot;./test/pwd&quot; \
    --safe-address 0x6a64fe01c3aba5bdcd04b81fef375369ca47326f \
    --module-address 0x5d46d0c5279fd85ce7365e4d668f415685922839 \
    --manager-private-key ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
    --private-key 59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d \
    --provider-url &quot;http://localhost:8545&quot;</code></pre></div>
<ul>
<li>Move registered nodes to a different set of safe and module</li>
</ul>
<div class="example-wrap"><pre class="language-text"><code>hopli safe-module move \
    --network anvil-localhost \
    --contracts-root &quot;../ethereum/contracts&quot;  \
    --old-module-address 0x5d46d0c5279fd85ce7365e4d668f415685922839 \
    --new-safe-address 0xce66d19a86600f3c6eb61edd6c431ded5cc92b21 \
    --new-module-address 0x3086c20265cf742b169b05cd0eae1941455e4e9f \
    --node-address 0x93a50B0fFF7b4ED36A3C6445e280E72AC2AEFc51,0x58033D3074D001a32bF379801eaf8969817fFfCf,0xeEDaab91158928647a9270Fe290897eBB1230250 \
    --manager-private-key ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 \
    --private-key 59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d \
    --provider-url &quot;http://localhost:8545&quot;

- Debug nodes and safe
```text
hopli safe-module debug \
    --network anvil-localhost2 \
    --contracts-root &quot;../ethereum/contracts&quot; \
    --identity-directory &quot;./test&quot; \
    --password-path &quot;./test/pwd&quot; \
    --safe-address 0x6a64fe01c3aba5bdcd04b81fef375369ca47326f \
    --module-address 0x5d46d0c5279fd85ce7365e4d668f415685922839 \
    --provider-url &quot;http://localhost:8545&quot;</code></pre></div></div></details><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">§</a></h2><dl class="item-table"><dt><a class="enum" href="enum.SafeModuleSubcommands.html" title="enum hopli_lib::safe_module::SafeModuleSubcommands">Safe<wbr>Module<wbr>Subcommands</a></dt><dd>CLI arguments for <code>hopli safe-module</code></dd></dl></section></div></main></body></html>